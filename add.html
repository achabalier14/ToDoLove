<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ajouter une activité</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Ajouter une activité</h1>
  <form id="activityForm">
    <input type="text" id="titre" placeholder="Titre" required><br>
    <textarea id="description" placeholder="Description"></textarea><br>
    <input type="text" id="lieu" placeholder="Lieu"><br>
    <input type="date" id="date"><br>
    <input type="file" id="image"><br>
    <button type="submit">Ajouter</button>
  </form>

  <!-- ✅ Le script est maintenant un module -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://jwbudzoqoiqzymxhifoo.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3YnVkem9xb2lxenlteGhpZm9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4NjI0NDksImV4cCI6MjA2NDQzODQ0OX0.p0uUr9KVWkUkS4MJS_EsT1ViygxnPrOCg-T0Xy91qh0'
    );

    document.getElementById('activityForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const titre = document.getElementById('titre').value;
      const description = document.getElementById('description').value;
      const lieu = document.getElementById('lieu').value;
      const dateInput = document.getElementById('date').value;
      const imageFile = document.getElementById('image').files[0];

      const date = dateInput === "" ? null : dateInput;
      let imageUrl = null;

      if (imageFile) {
        const fileName = `${Date.now()}_${imageFile.name}`;
        const { error: uploadError } = await supabase.storage
          .from('images')
          .upload(fileName, imageFile);

        if (uploadError) {
          alert("Erreur upload image : " + uploadError.message);
          return;
        }

        imageUrl = `https://jwbudzoqoiqzymxhifoo.supabase.co/storage/v1/object/public/images/${fileName}`;
      }

      const { error } = await supabase
        .from('activites')
        .insert([
          { titre, description, lieu, date, image: imageUrl }
        ]);

      if (error) {
        alert("Erreur ajout activité : " + error.message);
      } else {
        alert("Activité ajoutée !");
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>
